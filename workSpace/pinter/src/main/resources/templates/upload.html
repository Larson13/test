<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <title>文件上传练习</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/bootstrap-theme.min.css}" rel="stylesheet">
    <link th:href="@{/css/theme.css}" rel="stylesheet">
  </head>

  <body>

        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container" role="main">
                <div class="navbar-header">
                    <a class="navbar-brand" th:href="@{/index}">Pinter</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a th:href="@{/doc}">接口文档</a></li>

                    </ul>
                </div><!--/.navbar-collapse -->
            </div> <!-- /container -->
        </nav>
        <div class="container">
      <div class="jumbotron">
        <h2>文件上传要点</h2>
        <p>
            1、文件上传原理是浏览器将本地文件内容通过HTTP发送到服务端，服务端接收到数据后重新创建一个文件<br/>
            2、文件上传的HTTP请求content-type:multipart/form-data，MIME类型为application/octet-stream<br/>
            3、文件上传一般有表单上传和ajax上传两种方式
        </p>
      </div>
        <div class="row">
            <div class="col-md-6">
                <div class="page-header">
                    <h2>文件上传练习-表单上传</h2>
                </div>
                <form method="post" th:action="@{/file/api/upload}" enctype="multipart/form-data">
                    <div class="form-group" >
                        <label for="inputFile1">文件上传</label>
                        <input type="file" id="inputFile1" name="file">
                        <p class="help-block">提示：选择的文件不能大于20M</p>
                    </div>
                    <div class="form-group ">
                        <label for="remark">文件描述</label>
                        <textarea class="form-control" rows="3" placeholder="请输入文件描述" id="remark"></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">提交</button>
                    <a class="btn btn-primary" href="/pinter/file/page/list">查看我的文件</a>
                </form>
            </div>

            <div class="col-md-6">
                <div class="page-header">
                    <h2>文件上传练习-ajax上传</h2>
                </div>
                <div class="form-group" >
                    <label for="inputFile2">文件上传</label>
                    <input type="file" id="inputFile2" name="file">
                    <p class="help-block">提示：选择的文件不能大于20M</p>
                </div>
                <div class="form-group ">
                    <label for="remark">文件描述</label>
                    <textarea class="form-control" rows="3" placeholder="请输入文件描述" id="remark"></textarea>
                </div>
                <button class="btn btn-success" id="upload">提交</button>
                <a class="btn btn-primary" href="/pinter/file/page/list">查看我的文件</a>
            </div>
        </div>

            <hr/>
            <footer>
                <p th:utext="${desc}"></p>
            </footer>
        </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script th:src="@{/js/jquery.min.js}"></script>
    <script th:src="@{/js/bootstrap.min.js}"></script>
    <script th:src="@{/js/docs.min.js}"></script>
  <script>
      $(function () {
          $("#upload").click(function () {
              var formData = new FormData();
              formData.append("file", document.getElementById("inputFile2").files[0]);
              $.ajax({
                  url: "/pinter/file/api/upload2",
                  type: "POST",
                  data: formData,
                  /**
                   *必须false才会自动加上正确的Content-Type
                   */
                  contentType: false,
                  /**
                   * 必须false才会避开jQuery对 formdata 的默认处理
                   * XMLHttpRequest会对 formdata 进行正确的处理
                   */
                  processData: false,
                  success: function (data) {
                      alert(data.message);
                  },
                  error: function () {
                      alert("上传失败");
                  }
              });
          });
      });
  </script>
  </body>
</html>
